# 11회차 : OS 2024.4.4

| depth 0 | 검색하면 바로 나오는 내용 위주인 경우. 내용을 모르더라도 즉석으로 생각해내서 대답할 수 있는 단계   |
|---------|-----------------------------------------------------------|
| depth 1 | 검색하면 바로 나오는 내용에서 약간의 꼬리질문이 들어오는 경우, 검색을 통해서 조금 읽어봐야 하는 단계 |
| depth 2 | 검색을 통해서 읽고, 이해가 필요한 경우. 배경지식이 없으면 대답하기 어려운 단계             |
| depth 3 | 검색을 해서 한참 읽고 생각해야 하는 경우, 배경지식이 없으면 이해를 하지 못하는 단계          |
| depth 4 | 검색을 해도 거의 내용이 나오지 않는 경우, 정답이 없는 경우. 읽어봐도 전혀 모르는 내용인 단계    |

# Q: 프로그램과 프로세스의 차이와 스레드에 대해서 설명해주세요(depth 1)

  ### **프로그램이란?**

  프로그램은 디스크와 같은 저장 매체에 저장되어 있는 실행 가능한 코드의 집합으로, 특정 작업을 수행하기 위한 명령어와 데이터로 구성됩니다. 이는 아직 실행되지 않은 정적인 상태입니다.

  ### **프로세스(Process)**

  프로세스는 실행 중인 프로그램을 의미하며, 디스크로부터 메모리에 적재되어 실행되는 동적인 작업의 단위입니다. 운영 체제는 프로세스에 CPU 시간, 메모리 공간, 파일 핸들과 같은 시스템 자원을 할당합니다.
  프로세스는 독립된 메모리 영역을 갖으며, 이는 Code, Data, Stack, Heap 구조로 구성됩니다. 프로세스 간 통신을 위해서는 IPC(Inter-Process Communication) 메커니즘이
  필요하며, 이는 프로세스들이 서로 데이터를 주고받을 수 있도록 합니다.

  ![os1.png](image%2Fos1.png)

  ### **스레드(Thread)**

  스레드는 프로세스 내의 실행 단위로, 프로세스의 자원과 메모리 공간을 공유하면서 실행됩니다. 각 스레드는 독립된 스택과 프로그램 카운터를 가지며, 프로세스 내의 Code, Data, Heap 영역은 공유합니다.
  이로 인해 스레드 간 통신은 상대적으로 간단하지만, 공유 자원에 대한 동시 접근을 제어하기 위한 동기화 메커니즘이 필요합니다.

  ![os2.png](image%2Fos2.png)

  ### **멀티 프로세스 vs 멀티 스레드**

  ### 멀티 프로세스(Multi-Process)

  멀티 프로세스 방식은 하나의 응용 프로그램을 여러 개의 프로세스로 구성하여 각각 독립적으로 작업을 수행하게 하는 것입니다. 이 방식의 장점은 하나의 프로세스에 문제가 발생해도 다른 프로세스에는 영향을 미치지
  않는다는 안정성입니다. 하지만, 프로세스 간 통신(IPC)이 복잡하고, 컨텍스트 스위칭 시 오버헤드가 큰 단점이 있습니다.

  ### 멀티 스레드(Multi-Thread)

  하나의 응용 프로그램 내에서 여러 스레드를 생성하여 각각의 작업을 병렬로 처리하는 방식입니다. 멀티 스레드는 메모리 공간과 시스템 자원의 소모를 줄이고, 스레드 간 데이터 공유가 용이하며, 컨텍스트 스위칭이
  빠르다는 장점을 가집니다. 그러나, 스레드 간 자원 공유로 인한 동기화 문제가 발생할 수 있고, 하나의 스레드에서 발생한 오류가 전체 프로세스에 영향을 줄 수 있는 단점이 있습니다.

  ### **스택과 프로그램 카운터(PC)의 중요성**

  각 스레드가 독립적인 스택을 가지는 이유는 함수 호출과 로컬 변수 관리를 개별적으로 수행하기 위함입니다. 프로그램 카운터(PC)는 스레드가 다음에 실행할 명령어의 위치를 가리키므로, 스레드가 CPU를 할당받을
  때마다 현재 실행 중인 코드의 정확한 위치를 파악할 수 있도록 합니다. 이는 스레드마다 독립적으로 관리되어야 합니다.

  ### **결론**

  멀티 프로세스와 멀티 스레드 각각의 장단점을 이해하고 적절한 상황에서 적합한 방식을 선택하는 것은 응용 프로그램의 효율성과 안정성을 극대화하는 데 중요합니다. 프로세스와 스레드의 독립적인 작업 단위로서의 역할과
  상호작용을 통해, 복잡한 작업을 효과적으로 관리하고 실행할 수 있습니다.

# Q: 인터럽트에 대해서 설명해주세요. (depth 1)

### **인터럽트**

- 하드웨어 장치가 CPU에게 어떤 사실을 알려주거나 CPU의 서비스를 요청해야 할 경우, CPU 내에 있는 인터럽트 라인을 세팅하여 인터럽트를 발생시킨다. (프로그램이 명령을 수행하기 위해서는 CPU를
      할당받아야 함)
- CPU는 매번 프로그램 카운터가 가리고 있는 곳의 명령을 수행한 뒤, 다음 명령을 수행하기 직전에 인터럽트 라인이 세팅되었는지 체크한다.
- 이를 통해 인터럽트가 발생했으면 CPU는 현재 수행 중이던 프로세스를 멈추고 운영 체제의 인터럽트 처리 루틴으로 이동하여 인터럽트 처리를 수행한다.

### **인터럽트의 작동 과정**

1. **인터럽트 요청:** 하드웨어 장치 또는 소프트웨어가 인터럽트 라인을 통해 CPU에 인터럽트를 발생시킵니다.
2. **인터럽트 체크:** CPU는 명령 실행 후 다음 명령을 실행하기 전에 인터럽트 라인을 체크하여 인터럽트 요청이 있는지 확인합니다.
3. **인터럽트 처리:** 인터럽트가 발생하면, CPU는 현재 수행 중인 프로세스의 상태를 저장한 후, 운영 체제의 인터럽트 처리 루틴으로 제어를 이동시켜 해당 인터럽트를 처리합니다.
4. **작업 복귀:** 인터럽트 처리가 완료되면, CPU는 이전에 중단된 프로세스의 상태를 복원하여 작업을 계속 진행합니다.

  ![os3.png](image%2Fos3.png)

  ### **인터럽트의 종류**

  1. **하드웨어 인터럽트:** 주로 하드웨어 장치에서 발생하는 인터럽트로, 장치의 서비스 요청이나 특정 사건을 CPU에 알립니다.
  2. **소프트웨어 인터럽트:**
      - **예외 상황 (Exception):** 프로그램이 허용되지 않은 연산을 수행할 때 자동으로 발생합니다. 예를 들어, 0으로 나누기나 유효하지 않은 메모리 참조 등이 있습니다.
      - **시스템 콜 (System Call):** 사용자 프로세스가 운영체제의 서비스를 요청하기 위해 발생시킵니다. 이는 특정 기능이나 데이터에 대한 접근 권한이 필요할 때 사용됩니다.

  ### **인터럽트 처리 과정**

  - **인터럽트 벡터 (Interrupt Vector):** 다양한 인터럽트에 대응하는 처리 루틴의 주소를 담고 있는 테이블입니다. 이를 통해 인터럽트 발생 시 처리해야 할 루틴을 신속하게 찾을 수 있습니다.
  - **인터럽트 핸들러 (Interrupt Handler):** 인터럽트에 대한 실제 처리를 담당하는 코드로, 운영체제 내에 위치합니다. 인터럽트 벡터에 의해 참조되며, 발생한 인터럽트에 맞는 적절한 조치를
    수행합니다.

  ![os4.png](image%2Fos4.png)

# Q: Context Switching에 대하여 설명해주세요. (depth 1)

### **컨텍스트 스위칭(CPU Context Switching)이란?**

컨텍스트 스위칭은 다중 프로그래밍 환경에서 CPU가 한 작업(프로세스 또는 스레드)에서 다른 작업으로 전환할 때 발생하는 과정입니다. 이 과정에서 시스템은 현재 실행 중인 태스크의 상태를 저장하고, 다음에 실행할
태스크의 상태를 불러와 CPU가 이전 작업을 중단한 지점부터 연속적으로 수행할 수 있도록 합니다.

- **컨텍스트 스위칭의 필요성:** 컨텍스트 스위칭은 다중 작업 처리를 가능하게 하여, 컴퓨터 시스템의 효율성과 반응성을 크게 향상시킵니다. 사용자 입장에서는 여러 프로그램이 동시에 실행되는 것처럼 느낄 수 있습니다.
- **최적화:** 컨텍스트 스위칭 비용을 최소화하기 위해, 운영 체제는 태스크 스케줄링 알고리즘을 최적화하여 불필요한 컨텍스트 스위칭을 줄이고, 시스템 리소스를 효율적으로 사용하려고 합니다.

### **과정**

1. **현재 실행 중인 태스크의 상태 저장:** CPU는 현재 실행 중인 태스크의 상태를 프로세스 제어 블록(Process Control Block, PCB)에 저장합니다. 여기에는 레지스터 값, 프로그램 카운터, 스택 포인터 등 태스크를 재개하는 데 필요한 정보가 포함됩니다.
2. **다음 태스크의 상태 복원:** 시스템은 다음 실행할 태스크의 PCB에서 상태 정보를 읽어와 CPU의 레지스터에 로드합니다. 이를 통해 CPU는 새 태스크를 마치 이전에 중단된 지점부터 계속 실행하는 것처럼 처리할 수 있습니다.

### **컨텍스트 스위칭의 비용**

컨텍스트 스위칭은 비용이 많이 드는 작업입니다. 이 비용에는 캐시 초기화, 메모리 매핑 초기화, CPU 레지스터 값의 저장 및 복원 등이 포함됩니다. 커널은 시스템의 다른 부분보다 우선 실행되어야 하므로, 컨텍스트
스위칭 중에도 시스템의 핵심 기능을 유지 관리해야 합니다.

### **프로세스와 스레드 간의 차이점**

프로세스 간의 컨텍스트 스위칭은 스레드 간의 컨텍스트 스위칭보다 비용이 더 많이 듭니다. 이는 스레드가 프로세스 내에서 스택을 제외한 모든 메모리 공간(코드, 데이터, 힙 등)을 공유하기 때문입니다. 따라서 스레드
간 전환 시에는 상대적으로 변경해야 할 메모리 영역이 적어, 프로세스 전환보다 효율적입니다.

# Q: 프로세스 vs 스레드 차이

```
프로세스: 운영체제로부터 자원을 할당받은 작업의 단위
스레드: 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위
```

- 스레드는 프로세스내에서 실행되는 흐름이라 사전적 정의가 나온다. 프로세스가 공장이라면 스레드는 일꾼이다 프로세스의 자원을 할당받아 실행하는 단위이다
  스레드는 프로세스 내에서 `Stack`은 따로 할당받지만 `Heap, Data , Code`의 영역은 공유한다 각 스레드 들은 공통의 힙 메모리를 읽을 수 있다.
  스택이란건 결국 작업의 단위이고 스택을 서로 다르게 가짐으로서 스레드들이 서로 다른일을한다.
   - 자바의 스레드는 jvm이 운영체제 역할을 한다. 자바는 프로세스가 존재하지 않고 스레드만 존재.

> [https://inpa.tistory.com/entry/👩‍💻-프로세스-⚔️-쓰레드-차이](https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4)


# Q: 멀티 스레드 프로그래밍을 할 때 주의해야 할 점?
- 멀티 프로세스 특징
  - 여러 프로그램이 실행중 IPC를 이용한 통신, 동기화 작업이 필요하지 않다. 즉 여러 자식 프로세스 중 하나에 문제가 발생하면 해당 자식 프로세스만 죽고 다른 영향이 확산되지 않는다.
  - **Context Switching**과정에서 캐시 메모리가 초기화 되는 등의 무거운 작업이 진행되고 많은 시간이 소모되는 등의 오버헤드가 발생한다.
  - 프로세스는 독립된 메모리 영역을 할당 받기 때문에 프로세스 사이에서 공유하는 메모리가 없다.
- 멀티 스레드 특징
    - 하나의 프로그램에서 여러가지 일을 할 수 있다. 하나의 프로세스를 여러 스레드가 자원을 나눠 쓴다. 자원을 나눠 쓰기 때문에 동기화 작업이 필요하다. (서로 다른 스레드가 데이터와 힙 영역을
      공유하기 때문)
    - 프로세스는 컨텍스트 스위칭 비용이크지만 스레드는 비교적 적다.
    - 이렇게 본다면 멀티 프로세스 보다는 멀티 스레드의 이점이 훨씬 커보인다. 자원의 소모성도 그렇고 하지만 멀티 스레드에는 치명적인 단점 이있다.
- 멀티 스레드의 단점
    - 다중의 스레드중 한 스레드에 치명적인 문제가 생기면 프로세스 전체에 영향이 갈수있다.
    - 자원을 공유`(임계영역)`하기 때문에`경쟁상태(레이스 컨디션)`에 놓일 가능성이있고,`동기화`작업이 필요(줄을 세운다)하다. 하지만 이때문에`교착 상태`(데드락)이 생길 수 있다. 그러므로
      과도한`lock`은 자제한다 공유 자원이 아닌부분에는 동기화 처리가 불필요하다. 즉, 동기화 처리가 필요한 부분에만`synchronized`처리하자

    ```
    데드락은 승려와 젓가락을 기억하자 스레드가 자원을 얻지 못해 굶어죽는다.
    ```

  프로세스 와 스레드의 컨텍스트 스위칭 차이는
    
  - 프로세스는 PCB를 거치기 때문에 비용적으로 더크다

# Q: 동기 프로그래밍, 비동기 프로그래밍
- 동시성(Concurrency) vs 병렬성(Parallelism)
  - 동시성 : 동시적 하나의 프로세서가 cpu를 스케쥴링 되면서 한 줄로 서있는 프로세스를 번갈아 가면서(컨텍스트 스위칭) 작업을 한다. 그렇기 때문에 동시에 여러 작업을 하는것은 아니다 그렇게
          보일뿐.
  - 병렬성 : 실제로 동시에 여러 작업이 처리되는 것, 멀티 코어에서 멀티 쓰레드(Multi thread)를 동작시키는 방식이다.
  - 비동기 프로그래밍
    - 여러 일이 동시에 발생 할 수 있다. 즉 여러 작업을 독립적으로 실행 할 수 있다.
    - 실행의 흐름을 막지 않는다.
    - 쉽게 말하면 코드가 한줄 한줄 순서대로 진행 되는것이아니다. ex) 배달부가 그릇을 수거하기 위해 손님이 다 먹을때까지 기다려야 하는것은 아니다. 다음 배달을 진행하고 있으면된다.
    - 비동기식 프로그래밍에서 중요한것은`call back 함수`이다. 함수가 진행될 때 결과 값이나 진행하다 다시 돌아가야할 때 이것을 알게 하는 함수가 callback함수.
        - 동기 프로그래밍은 코드가 작성한 순서대로 실행된다. 호출되는 함수의 작업 완료 여부를 신경쓴다.
- 동기(synchronous) vs 비동기(asynchronous)
    - 동기:  결과가 주어질 때까지 아무것도 못하고 대기한다.
    - 비동기:  서로의 작업에 영향을 받지 않는다. 별도의 작업 시작 종료를 가진다. 보통 멀티 스레드에서 작동.

  [https://velog.io/@pllap/Java에서의-비동기-프로그래밍](https://velog.io/@pllap/Java%EC%97%90%EC%84%9C%EC%9D%98-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D)

# Q: 멀티 스레드 프로그래밍, 비동기 프로그래밍(Asynchronous Programming)의 차이는?
- 비동기 프로그래밍(asynchronou programming)은 여러 작업을 하는 하나의 방법론 적인 것이다.`멀티 프로그래밍은 이 비동기 프로그램의 한 종류이다.`비동기 프로그래밍은 결국 단일,멀티
  스레드 모두에서 적용 할 수 있다.   

  비동기적 모델에서는 **여러 일이 동시에 발생할 수 있다.** 프로그램은 실행시간이 긴 함수를 실행할 때, **그 함수의 실행 흐름을 막지(non-blocking) 않고**, 프로그램을 계속 실행한다. 그리고
  그 함수가 끝났을 때, 프로그램은 실행결과에 접근한다.

- **멀티스레딩은 하나 이상의 순차적 명령어 세트(sequential set of instructions)를 동시/병렬적(concurrent/parallel)으로 실행하는 것을 말한다.**

  단일 프로세서(single processor)에서, 멀티스레딩으로 실행하는 프로그램은 마치 병렬적으로 실행되는 것 처럼 보인다. 하지만 실제로는, 한 프로세서가 스케줄링 알고리즘을 통해 문맥을 전환(
  switching)해가며 실행하는 것이다.

> 정리 하자면 **멀티스레딩은 작업자(Thread)에 관한 것이고, 비동기는 작업(Task)에 관한 것**임을 알 수 있다.
      

  다중 프로세서(multiple processor) 코어에서의 스레드들이 실제로 병렬적이다. 개별 마이크로프로세서들(individual microprocessors)이 함께 작동하며 결과를 더 효율적으로
  달성한다. 여러 작업이 병렬, 동시적으로 수행된다.

  즉 정리해보면  **멀티스레딩 프로그래밍은 여러 다른 함수들을 동시에 실행하는 것을 말한다**

  참고: [https://jayhyun-hwang.github.io/2021/09/02/The-Difference-Between-Asynchronous-And-Multi-Threading/](https://jayhyun-hwang.github.io/2021/09/02/The-Difference-Between-Asynchronous-And-Multi-Threading/)

  - 비동기 프로그래밍의 방법
      - 스레드를 여러개 만든다 -> 멀티 스레드
          - 스레드를 여러개 만들때 발생하는 많은 컨텍스트 스위칭 비용.
          - 여러 스레드가 자원을 공유해서 발생하는 레이스 컨디션.
      - non -block i/o 논(0 블로킹 i/0)라고 봐도 무방 싱글 스레드여도 비동기 프로그래밍이 가능.
      - 결론 적으로 두 가지 방법을 통해 좋은 성능을 내는 비동기 프로그래밍을 할 수 있다.
      - 메세지 큐를 이용해 동기 프로그램에서 생길 수 있는 오류를 예방 할 수있다.